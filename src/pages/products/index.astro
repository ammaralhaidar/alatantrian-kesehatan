---
import Layout from '~/layouts/PageLayout.astro';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Image from '~/components/common/Image.astro';
import Button from '~/components/ui/Button.astro';
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';

const metadata = {
  title: 'Solusi Lengkap: Produk & Layanan',
  description: 'Katalog lengkap hardware kiosk, software antrian, dan layanan maintenance untuk Faskes.',
};

// Ambil semua data dari folder products
const allItems = await getCollection('product');

// Filter: Pisahkan Barang dan Jasa
const products = allItems.filter((item) => item.data.productType === 'product');
const services = allItems.filter((item) => item.data.productType === 'service');
---

<Layout metadata={metadata}>
  <section class="page-header py-12 md:py-20 bg-blue-50 dark:bg-slate-800">
    <Headline
      title="Ekosistem Solusi Antrian"
      subtitle="Kombinasi Hardware tangguh, Software cerdas, dan Layanan purna jual terpercaya."
    />
  </section>

  {
    products.length > 0 && (
      <WidgetWrapper containerClass="max-w-7xl mx-auto" isDark={false}>
        <div class="mb-8 text-center">
          <span class="text-sm font-bold tracking-wider uppercase text-primary">Katalog Utama</span>
          <h2 class="text-3xl font-bold font-heading">Hardware & Software</h2>
        </div>

        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
          {products.map((product) => (
            <div class="group relative flex flex-col rounded-lg border border-gray-200 bg-white shadow-lg transition hover:shadow-2xl dark:border-gray-700 dark:bg-slate-900">
              <div class="aspect-w-16 aspect-h-9 overflow-hidden rounded-t-lg bg-gray-100 relative">
                {product.data.image ? (
                  <Image
                    src={product.data.image}
                    alt={product.data.title}
                    class="h-64 w-full object-cover transition duration-500 group-hover:scale-105"
                    widths={[400, 768]}
                    width={768}
                    height={432}
                  />
                ) : (
                  <div class="h-64 flex items-center justify-center text-gray-400">No Image</div>
                )}
              </div>

              <div class="flex flex-1 flex-col justify-between p-6">
                <div>
                  <div class="mb-2">
                    <span class="rounded bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                      {product.data.category}
                    </span>
                  </div>
                  <h3 class="mb-2 text-xl font-bold leading-tight dark:text-white">
                    <a href={`/products/${product.id}`} class="hover:text-primary transition">
                      {product.data.title}
                    </a>
                  </h3>
                  <p class="text-muted dark:text-gray-400 line-clamp-3">{product.data.description}</p>
                </div>

                <div class="mt-6 flex items-center justify-between border-t border-gray-100 pt-4 dark:border-gray-800">
                  <Button
                    variant="secondary"
                    href={`/products/${product.id}`}
                    class="w-full sm:w-auto px-4 py-2 text-sm"
                  >
                    Lihat Detail
                  </Button>
                </div>
              </div>
            </div>
          ))}
        </div>
      </WidgetWrapper>
    )
  }

  {
    services.length > 0 && (
      <div class="bg-slate-50 dark:bg-slate-900/50 border-t border-gray-200 dark:border-slate-800">
        <WidgetWrapper containerClass="max-w-7xl mx-auto" isDark={false}>
          <div class="mb-12 text-center">
            <span class="text-sm font-bold tracking-wider uppercase text-secondary">Support System</span>
            <h2 class="text-3xl font-bold font-heading">Layanan Profesional</h2>
            <p class="mt-4 text-muted text-lg max-w-3xl mx-auto">
              Kami mendukung operasional Anda mulai dari instalasi hingga perawatan berkala.
            </p>
          </div>

          <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {services.map((service) => (
              <a
                href={`/products/${service.id}`}
                class="flex flex-col p-6 bg-white dark:bg-slate-800 rounded-lg shadow hover:shadow-lg transition border border-gray-100 dark:border-gray-700 group"
              >
                <div class="flex items-center mb-4">
                  <div class="p-3 rounded-full bg-blue-50 dark:bg-blue-900 text-primary mr-4 group-hover:bg-primary group-hover:text-white transition">
                    {service.data.icon ? (
                      <Icon name={service.data.icon} class="w-8 h-8" />
                    ) : (
                      <Icon name="tabler:tool" class="w-8 h-8" />
                    )}
                  </div>
                  <h3 class="text-xl font-bold leading-tight">{service.data.title}</h3>
                </div>
                <p class="text-muted dark:text-gray-400 flex-1">{service.data.description}</p>
                <div class="mt-4 text-primary font-medium text-sm flex items-center group-hover:translate-x-2 transition-transform">
                  Baca Selengkapnya <Icon name="tabler:chevron-right" class="w-4 h-4 ml-1" />
                </div>
              </a>
            ))}
          </div>
        </WidgetWrapper>
      </div>
    )
  }
</Layout>
